// Generated by CoffeeScript 2.5.1
(function() {
  'use strict';
  var formElement, otpElement, otpLabel, secretInput, submitButton, validate;

  formElement = document.querySelector('form');

  secretInput = document.querySelector('#secret');

  otpElement = document.querySelector('#otp');

  otpLabel = document.querySelector('#otp-label');

  submitButton = document.querySelector('#submit-button');

  validate = function() {
    submitButton.disabled = false;
    if (!otpElement.value.match(/^\d{6}$/)) {
      otpLabel.innerHTML = 'Wrong format';
      otpElement.classList.add('status-bad');
      return submitButton.disabled = true;
    } else {
      otpLabel.innerHTML = '';
      return otpElement.classList.remove('status-bad');
    }
  };

  formElement.addEventListener('submit', async function(e) {
    var res, value;
    e.preventDefault();
    res = (await fetch('/console/api/v0.1/verify-otp/', {
      method: 'post',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        secret: secretInput.value,
        token: otpElement.value
      })
    }).catch(function() {
      return alert('Could not check your code. Please check your internet connection.');
    }));
    if (res.status === 429) {
      value = submitButton.value;
      submitButton.disabled = true;
      submitButton.value = 'Too many attempts';
      return setTimeout(function() {
        submitButton.disabled = false;
        return submitButton.value = value;
      }, 10000);
    } else if (!res.ok) {
      switch ((await res.text())) {
        case 'WRONG_CODE':
          otpLabel.innerHTML = 'Wrong code';
          otpElement.classList.add('status-bad');
          return submitButton.disabled = true;
      }
    } else {
      return formElement.submit();
    }
  });

  (function() {
    return validate();
  })();

  addEventListener('input', validate);

}).call(this);

//# sourceMappingURL=setup_otp.js.map
