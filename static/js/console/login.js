// Generated by CoffeeScript 2.5.1
(function() {
  'use strict';
  var formElement, otpElement, otpLabel, passwordElement, passwordLabel, submitButton, usernameElement, usernameLabel, validate;

  formElement = document.querySelector('form');

  usernameElement = document.querySelector('#username');

  passwordElement = document.querySelector('#password');

  otpElement = document.querySelector('#otp');

  usernameLabel = document.querySelector('#u-label');

  passwordLabel = document.querySelector('#p-label');

  otpLabel = document.querySelector('#otp-label');

  submitButton = document.querySelector('#submit-button');

  validate = function() {
    submitButton.disabled = false;
    if (!usernameElement.value.length) {
      usernameLabel.innerHTML = 'No username';
      usernameElement.classList.add('status-bad');
      submitButton.disabled = true;
    } else {
      usernameLabel.innerHTML = '';
      usernameElement.classList.remove('status-bad');
    }
    passwordLabel.innerHTML = '';
    passwordElement.classList.remove('status-bad');
    if (otpElement.value && !otpElement.value.match(/^\d{6}$/)) {
      otpLabel.innerHTML = 'Wrong format';
      otpElement.classList.add('status-bad');
      return submitButton.disabled = true;
    } else {
      otpLabel.innerHTML = '';
      return otpElement.classList.remove('status-bad');
    }
  };

  formElement.addEventListener('submit', async function(e) {
    var res, value;
    e.preventDefault();
    res = (await fetch('/console/api/v0.1/verify-login/', {
      method: 'post',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        username: usernameElement.value,
        token: otpElement.value,
        password: passwordElement.value
      })
    }).catch(function() {
      return alert('Could not log you in. Please check your internet connection.');
    }));
    if (res.status === 429) {
      value = submitButton.value;
      submitButton.disabled = true;
      submitButton.value = 'Too many attempts';
      return setTimeout(function() {
        submitButton.disabled = false;
        return submitButton.value = value;
      }, 10000);
    } else if (!res.ok) {
      switch ((await res.text())) {
        case 'NO_USER':
          usernameLabel.innerHTML = 'No such user';
          usernameElement.classList.add('status-bad');
          return submitButton.disabled = true;
        case 'WRONG_PASSWORD':
          passwordLabel.innerHTML = 'Wrong password';
          passwordElement.classList.add('status-bad');
          return submitButton.disabled = true;
        case 'WRONG_TOKEN':
          otpLabel.innerHTML = 'Wrong code';
          otpElement.classList.add('status-bad');
          return submitButton.disabled = true;
      }
    } else {
      return formElement.submit();
    }
  });

  addEventListener('load', validate);

  addEventListener('input', validate);

}).call(this);

//# sourceMappingURL=login.js.map
